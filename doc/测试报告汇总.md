<div align='center' ><font size='10'><big><b>测试报告汇总</b></big></font></div>

[1 工程准备](#1-工程准备) 

[2 预期测试结果及分析方向](#2-预期测试结果及分析方向)

[3 测试结果](#3-测试结果) 

[4 结果分析](#4-结果分析) 



# 概要   
本报告汇总 ssd 算法 和 yolov5 算法的测试结果，以便对比。 


# 1 工程准备
## 1.1 数据集
训练集：[dmcode](http://172.16.102.80/#/image-display?storeId=37&type=1): 5736张； [qrcode](http://172.16.102.80/#/image-display?storeId=38&type=1): 5538张； [barcode](http://172.16.102.80/#/image-display?storeId=36&type=1): 8728张； [multicode(去除测试集)](http://172.16.102.80/#/image-display?storeId=46&type=1): 8128张； 共28130张   
测试集： [99张](http://172.16.102.80/#/image-display?storeId=46&type=1) 
## 1.2 工程代码及运行环境
代码见公司[git](http://smartgiant.float-zone.com:12178/vision/object_detect/ai_barcode_detect_ssd)   


各模型检测结果以表格形式统计，表格中   
TP 代表检测结果中正确的个数，   
FP 代表检测结果中错误的个数（也就是误检情况），   
TP+FN 代表正样本个数（真实框的个数），   
FN 代表未检测到但实际上有（也就是漏检情况）    
漏检率 =  FN/(TP+FN)  
AP(Average Precision) 代表平均精度。

# 2 SSD算法   
   

## 2.1 ssd-s  


该表格统计的为ssd-s模型，epoch = 1000 的检测结果。

|        | TP | FP(误检)|TP + FN|FN(漏检)|漏检率| AP|
| ------ | -- | --| ----- |---|---|---|
| dmcode | 44 |  2|    47 |  3 |   0.064|0.93|
|qrcode  | 65 |  0|     76|  11 |   0.145|0.86|
|barcode | 100 |  2|    152|   52|   0.342|0.66| 
## 2.2 ssd-m   
该表格统计的为ssd-m模型，epoch = 1000 的检测结果。   
 
|        | TP | FP(误检)|TP + FN|FN(漏检)|漏检率| AP|
| ------ | -- | --| ----- |---|---|---|
| dmcode | 43 | 3 |    47 | 4 | 0.08 |0.91|
|qrcode  | 74 |  0|     76| 2 | 0.03 |0.97|
|barcode | 116 | 5 | 152 | 34 | 0.22 |0.75| 
## 2.3 ssd-s ciou   
该表格统计的为ssd-s模型，更改损失函数为ciou 的检测结果。   

|        | TP | FP(误检)|TP + FN|FN(漏检)|漏检率| AP|
| ------ | -- | --| ----- |---|---|---|
| dmcode | 43 | 1 |    47 | 4 | 0.085 |0.91|
|qrcode  | 66 |  0|     76| 10 | 0.132 |0.87|
|barcode | 101 | 3 | 152 | 51 | 0.335 |0.66|

# 3 yolov5算法
## 3.1 yolov5s
该表格统计的为yolov5s模型，epoch = 214 的检测结果。 
   
|        | TP | FP(误检)|TP + FN|FN(漏检)|漏检率| AP|
| ------ | -- | --| ----- |---|---|---|
| dmcode | 47 | 7 |    47 | 0 | 0 |0.98|
|qrcode  | 75 |  1|     76| 1 | 0.013 |0.99|
|barcode | 151 | 8 | 152 | 1 | 0.007 |0.99|  

考虑到模型大小，目前只训练了yolov5s.

# 4 结果分析
1. 对比 表2.1 和 表2.2 可以看出，ssd-m 模型整体优于 ssd-s模型，验证增加通道数对模型检测结果有积极作用。
2. 对比表2.1 和 表2.3 可以看出，更改loss函数为ciou对模型检测无明显改进，且单独测试过具有高长宽比的芯片数据集，均无明显效果。
3. 从表3.1 看出yolov5s模型效果最好，误检情况略高，查看检测结果后发现dmcode大部分误检是检测到了残缺码。如下所示： (左边为检测结果，右边为标签)    

![](./img/yolov5s_1.png)   


可以看出所有这张图中所有残缺码均检测到，且置信度也很高，通过阈值进行筛除不可行。该模型检测时默认置信度阈值0.25.
而barcode误检情况可以通过提升阈值筛除部分。经过多次检测，最终阈值设置为0.5时效果最好。结果如下


|        | TP | FP(误检)|TP + FN|FN(漏检)|漏检率| AP|
| ------ | -- | --| ----- |---|---|---|
| dmcode | 47 | 7 |    47 | 0 | 0 |0.98|
|qrcode  | 75 |  1|     76| 1 | 0.013 |0.99|
|barcode | 151 | 3 | 152 | 1 | 0.007 |0.99|   
# 4 增加 yolov5s 1/2 通道数测试 
训练集增加[一维条码未标签 ：40张](http://172.16.102.80/#/image-display?storeId=36&type=1) ，[DM码fitbit : 694张](http://172.16.102.80/#/image-display?storeId=37&type=1)， [QR码创启 ： 82张](http://172.16.102.80/#/image-display?storeId=38&type=1) 共816张。模型为yolov5s通道数减半，训练1100轮的检测结果。
   
|        | TP | FP(误检)|TP + FN|FN(漏检)|漏检率| AP|
| ------ | -- | --| ----- |---|---|---|
| dmcode | 46 | 7 |    47 | 1 | 0.021 |0.96|
|qrcode  | 73 |  1|     76| 3 | 0.039 |0.96|
|barcode | 150 | 4 | 152 | 2 | 0.013 |0.99|   

可以看出通道数减半后模型检测结果mAP较正常模型略低，降低幅度非常小，在接受范围内，后续需要降低模型大小或检测时间时，可以考虑该模型。
# 5 增加 yolov5s 1/4 通道数测试
   
   
|        | TP | FP(误检)|TP + FN|FN(漏检)|漏检率| AP|
| ------ | -- | --| ----- |---|---|---|
| dmcode | 45 | 9 |    47 | 2 | 0.043 |0.94|
|qrcode  | 74 |  3|     76| 2 | 0.026 |0.97|
|barcode | 150| 16|    152| 2 | 0.013 |0.98|   

yolov5s 1/4通道数模型的检测效果略低于1/2通道数模型，降低幅度非常小，几乎可忽略不计，但模型大小降为4M左右。


  