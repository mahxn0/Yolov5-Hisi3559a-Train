<div align='center' ><font size='10'><big><b>qr码分三类的测试分析报告</b></big></font></div>




# 概要
<font size=5>通过图片解码时间衡量图片质量，并将图片分为三类，即fast,medium,slow，最终目的是为了检测出更好的图片用于解码，减少解码时间。该报告使用qrcode做测试，查看方法可行性。

## 1. 图片分类

从解码时间统计表中看出，qrcode划分时间为0-200ms,200-500ms,500ms-无限，比较合适。   

![](./img/table.png)   

划分后的图片见图库[fast:2194, mediun:2742, slow:495](http://172.16.102.80/#/image-display)
    
## 2. 训练数据集划分

```
data
├── trainval  0.9      
│   ├── train  0.9   
│   │   
│   └── val    0.1   
│   │  
└── test  0.1   
```    
为了防止划分数据集时不均匀，代码改为支持多txt文件下载，即对于每一类图片都按照上面比例划分，保证各类别数据的训练集，验证集，测试集比例相同。  
 
## 3. 测试结果    
    
训练模型为yolov5s, epochs = 107 (实际训练到1370轮，其中效果最好的是107轮)，其中qr1,qr2,qr3分别是 fast,medium,slow的标签。   
  
|        | TP | FP(误检)|TP + FN|FN(漏检)|漏检率| AP|
| ------ | -- | --| ----- |---|---|---|
|qr1 | 195 |  77|254 |59 |   0.232|0.65|
|qr2 | 244 |  76|300|56  |   0.187|0.77|
|qr3 | 32 |  20| 71|39   |   0.549|0.36|   

从中可以看出检测情况未达到预期，不能很好的依据解码时间来区分图片。误检漏检情况严重，90%以上是因为分错类别。
## 4. 结果分析
对检测结果当中分错类别的情况进行统计，查看是否有规律，如果有简单规律则可以通过时间划分来调节。分错类别情况统计如下：（GT 表示真实框GroundTruth ， DR 表示预测框DetectResult，iou threshold = 0.5）    
  
|   GT \ DR | DR_qr1 | DR_qr2|DR_qr3|
| ------    | --     | --    | ---- |
|GT_qr1     |        |  54   |6     |
|GT_qr2     |45      |       |12    |
|GT_qr3     | 29     | 8     |      |

例如对于qr1真实框 有54张被检测成qr2,6张被检测成qr3.   
从中可看出没有预期的规律，对于qr1真实框分错情况大部分是检测为类别qr2，而对于qr2真实框分错情况大部分是检测为类别qr1，无法通过设置解码时间阈值来调整。   
对于测试效果不理想，   
**可能原因如下**：   

 1. 数据集过少，具体数量在图片分类中有标明。
 2. 同为qr码，特征差距小，模型难以区分。 
 3. 解码时间还会受其他因素影响，如二维码存储信息量。   

**总结**： 简单通过解码时间对二维码进行细分，来定位到质量较好的图片，以此达到减少解码时间的目的，从目前研究来看，此方法行不通。   
   
**后续可考虑的方向**：   
1. 查找影响解码时长因素，综合分析。(考虑解码方法的影响因素)   
2. 调研图片质量评估方法，用于评估定位后的条码图片质量。(目前查找到的资料多用于图片压缩，对比压缩前后质量，不太适用于本工程)  
   
 
 